<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>Billing | Idea Trade</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
    body { background: #020617; color: #fff; font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
    .card { background: #0B1220; padding: 30px; border-radius: 20px; display: flex; gap: 30px; border: 1px solid #333; max-width: 900px; width: 100%; flex-wrap: wrap; }
    .col { background: #111827; padding: 20px; border-radius: 15px; flex: 1; border: 1px solid #2d3748; min-width: 300px; }
    h3 { margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px; }
    .pkg { padding: 15px; border: 1px solid #333; margin-bottom: 10px; border-radius: 10px; cursor: pointer; display: flex; justify-content: space-between; transition: 0.2s; }
    .pkg:hover { background: #1f2937; }
    .pkg.active { border-color: #7C3AED; background: #2e1065; box-shadow: 0 0 10px rgba(124, 58, 237, 0.4); }
    .summary-box { background: #000; padding: 20px; text-align: center; border-radius: 10px; margin: 20px 0; font-size: 24px; font-weight: bold; color: #34d399; }
    .register { width: 100%; padding: 15px; background: #7C3AED; color: white; border: none; border-radius: 30px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; }
    .register:hover { background: #6d28d9; }
    .cancel { width: 100%; padding: 10px; background: transparent; color: #ef4444; border: 1px solid #ef4444; border-radius: 30px; margin-top: 10px; cursor: pointer; }
</style>
</head>
<body>
<div class="card">
  <div class="col">
    <h3>Select Item to Unlock</h3>
    <div class="pkg" data-id="realtime"><span>Realtime Data</span> <span>2,500฿</span></div>
    <div class="pkg" data-id="gold"><span>Gold Signal</span> <span>2,500฿</span></div>
    <div class="pkg" data-id="petroleum"><span>Petroleum</span> <span>2,500฿</span></div>
    <div class="pkg" data-id="rubber"><span>Rubber Thai</span> <span>2,500฿</span></div>
    <div class="pkg" data-id="flow"><span>Flow Intraday</span> <span>2,500฿</span></div>
    <div class="pkg" data-id="tickmatch"><span>Tick Match</span> <span>2,500฿</span></div>
    <div class="pkg" data-id="sniper"><span>Sniper Trade</span> <span>2,500฿</span></div>
    <div class="pkg" data-id="volume"><span>Volume Profile</span> <span>2,500฿</span></div>
  </div>

  <div class="col">
    <h3>Payment Summary</h3>
    <p style="color: #aaa; font-size: 14px;">Selected items total:</p>
    <div class="summary-box" id="totalText">0฿</div>
    <button class="register" onclick="payNow()">CONFIRM PAYMENT</button>
    <button class="cancel" onclick="location.href='dashboard.html'">CANCEL</button>
  </div>
</div>

<script>
    const packages = document.querySelectorAll('.pkg');
    const totalText = document.getElementById("totalText");
    let selectedIds = [];
    const stored = localStorage.getItem("userProfile");
    if(!stored) { alert("Session Expired"); location.href="welcome.html"; }
    const user = JSON.parse(stored);
    const urlParams = new URLSearchParams(window.location.search);
    const targetId = urlParams.get('id');

    if(targetId) {
        packages.forEach(pkg => { if(pkg.dataset.id === targetId) selectPackage(pkg); });
    }

    packages.forEach(pkg => { pkg.addEventListener('click', () => { selectPackage(pkg); }); });

    function selectPackage(pkg) {
        const id = pkg.dataset.id;
        if (selectedIds.includes(id)) {
            selectedIds = selectedIds.filter(i => i !== id);
            pkg.classList.remove('active');
        } else {
            selectedIds.push(id);
            pkg.classList.add('active');
        }
        updateTotal();
    }

    function updateTotal() { totalText.innerText = (selectedIds.length * 2500).toLocaleString() + "฿"; }

    function payNow() {
        if(selectedIds.length === 0) return alert("กรุณาเลือกสินค้าอย่างน้อย 1 ชิ้น");
        if(!user.unlockedItems) user.unlockedItems = [];
        selectedIds.forEach(id => { if(!user.unlockedItems.includes(id)) user.unlockedItems.push(id); });
        user.role = "member";
        localStorage.setItem("userProfile", JSON.stringify(user));
        alert(`ชำระเงินสำเร็จ!\nคุณได้ปลดล็อค: ${selectedIds.join(", ")}`);
        window.location.href = "dashboard.html";
    }
</script>
</body>
</html>